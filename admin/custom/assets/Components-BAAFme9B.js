import{j as e}from"./jsx-runtime-DzdUgrn4.js";import{A as a}from"./AdminComponentEasyAccessSet__loadShare___mf_0_iobroker_mf_1_adapter_mf_2_react_mf_2_v5__loadShare__-CmYJ37BE.js";import{A as I,a as j}from"./AdminComponentEasyAccessSet__mf_v__runtimeInit__mf_v__-9o5tLcPN.js";import{A as t}from"./AdminComponentEasyAccessSet__loadShare___mf_0_mui_mf_1_material__loadShare__-EKOPJIKX.js";import"./AdminComponentEasyAccessSet__loadShare__react__loadShare__-CJmceRyn.js";import"./_commonjsHelpers-CE1G-McA.js";const{loadShare:y}=j,{initPromise:v}=I,b=v.then(p=>y("@iobroker/json-config",{customShareInfo:{shareConfig:{singleton:!0,strictVersion:!1,requiredVersion:"*"}}})),T=await b.then(p=>p());var r=T;class g extends r.ConfigGeneric{searchTimeout=null;constructor(o){super(o),this.state={...this.state,searchQuery:"",stations:[],selectedStation:null,loading:!1,error:null}}handleClose=()=>{this.props.onClose&&this.props.onClose(),this.setState({searchQuery:"",stations:[],selectedStation:null,error:null})};handleSearchChange=o=>{const s=o.target.value;this.setState({searchQuery:s}),this.searchTimeout&&clearTimeout(this.searchTimeout),s.length>=2?this.searchTimeout=setTimeout(()=>{this.searchStations(s)},500):this.setState({stations:[],selectedStation:null})};searchStations=async o=>{this.setState({loading:!0,error:null});try{const s=await this.props.oContext.socket.sendTo(`${this.props.oContext.adapterName}.${this.props.oContext.instance}`,"location",{query:o});s&&Array.isArray(s)?this.setState({stations:s,loading:!1}):this.setState({stations:[],loading:!1,error:a.I18n.t("stationSearch_no_results_found")})}catch(s){this.setState({loading:!1,error:a.I18n.t("stationSearch_error").replace("%s",s instanceof Error?s.message:String(s))})}};handleStationSelect=o=>{this.setState({selectedStation:o})};handleConfirm=()=>{this.state.selectedStation&&(console.log("Confirming station:",this.state.selectedStation),this.props.onStationSelected&&this.props.onStationSelected(this.state.selectedStation.id,this.state.selectedStation.name),this.handleClose())};renderItem(o,s){const{searchQuery:d,stations:_,selectedStation:i,loading:f,error:c}=this.state;return e.jsxs(t.Dialog,{open:!0,onClose:this.handleClose,maxWidth:"sm",fullWidth:!0,children:[e.jsx(t.DialogTitle,{children:a.I18n.t("stationSearch_title")}),e.jsxs(t.DialogContent,{children:[e.jsx(t.TextField,{autoFocus:!0,fullWidth:!0,label:a.I18n.t("stationSearch_input_label"),value:d,onChange:this.handleSearchChange,placeholder:a.I18n.t("stationSearch_input_placeholder"),sx:{mt:2,mb:2}}),f&&e.jsx(t.Box,{sx:{display:"flex",justifyContent:"center",p:2},children:e.jsx(t.CircularProgress,{})}),c&&e.jsx(t.Typography,{color:"error",sx:{p:2,textAlign:"center"},children:c}),!f&&!c&&_.length>0&&e.jsx(t.List,{sx:{maxHeight:400,overflow:"auto"},children:_.map(n=>{var m,u;return e.jsx(t.ListItem,{disablePadding:!0,children:e.jsx(t.ListItemButton,{selected:(i==null?void 0:i.id)===n.id,onClick:()=>this.handleStationSelect(n),children:e.jsx(t.ListItemText,{primary:n.name,secondary:n.type?`${n.type}${n.location?` (${(m=n.location.latitude)==null?void 0:m.toFixed(4)}, ${(u=n.location.longitude)==null?void 0:u.toFixed(4)})`:""}`:n.id})})},n.id)})}),!f&&!c&&d.length>=2&&_.length===0&&e.jsx(t.Typography,{color:"text.secondary",sx:{p:2,textAlign:"center"},children:a.I18n.t("stationSearch_no_results")}),d.length<2&&e.jsx(t.Typography,{color:"text.secondary",sx:{p:2,textAlign:"center"},children:a.I18n.t("stationSearch_min_chars")})]}),e.jsxs(t.DialogActions,{children:[e.jsx(t.Button,{onClick:this.handleClose,children:a.I18n.t("stationSearch_cancel")}),e.jsx(t.Button,{onClick:this.handleConfirm,variant:"contained",disabled:!i,children:a.I18n.t("stationSearch_confirm")})]})]})}}class A extends r.ConfigGeneric{constructor(o){super(o),this.state={...this.state,showStationSearch:!1}}renderItem(o,s){const d=r.ConfigGeneric.getValue(this.props.data,"hafasProfile"),_=r.ConfigGeneric.getValue(this.props.data,"clientName"),i=r.ConfigGeneric.getValue(this.props.data,"stationId"),f=r.ConfigGeneric.getValue(this.props.data,"stationName"),c=async l=>{const h=l.target.value;await this.onChange("hafasProfile",h)},n=async l=>{const h=l.target.value;await this.onChange("clientName",h)},m=()=>{this.setState({showStationSearch:!0})},u=()=>{this.setState({showStationSearch:!1})},x=async(l,h)=>{console.log("Station selected:",{id:l,name:h}),console.log("Saving stationId:",l),console.log("Saving stationName:",h),await this.onChange("stationId",l),await this.onChange("stationName",h);const S=r.ConfigGeneric.getValue(this.props.data,"stationId"),C=r.ConfigGeneric.getValue(this.props.data,"stationName");console.log("Saved values:",{savedId:S,savedName:C}),this.setState({showStationSearch:!1})};return e.jsxs(t.Box,{sx:{p:2},children:[e.jsx(t.Typography,{variant:"h5",sx:{mb:3},children:a.I18n.t("hafasConfig_title")}),e.jsxs(t.Box,{sx:{display:"flex",flexWrap:"wrap",gap:2},children:[e.jsxs(t.FormControl,{sx:{flex:"1 1 300px",minWidth:200},disabled:s,children:[e.jsx(t.InputLabel,{id:"hafas-profile-label",children:a.I18n.t("hafasConfig_profile_label")}),e.jsxs(t.Select,{labelId:"hafas-profile-label",id:"hafas-profile-select",value:d||"",label:a.I18n.t("hafasConfig_profile_label"),onChange:c,children:[e.jsx(t.MenuItem,{value:"vbb",children:a.I18n.t("hafasConfig_profile_vbb")}),e.jsx(t.MenuItem,{value:"db",children:a.I18n.t("hafasConfig_profile_db")})]}),e.jsx(t.FormHelperText,{children:a.I18n.t("hafasConfig_profile_helper")})]}),e.jsx(t.FormControl,{sx:{flex:"1 1 300px",minWidth:200},disabled:s,children:e.jsx(t.TextField,{id:"client-name-input",label:a.I18n.t("hafasConfig_clientName_label"),value:_||"",onChange:n,helperText:a.I18n.t("hafasConfig_clientName_helper"),disabled:s})})]}),e.jsxs(t.Box,{sx:{mt:3,display:"flex",gap:2,alignItems:"flex-start"},children:[e.jsx(t.TextField,{fullWidth:!0,label:a.I18n.t("hafasConfig_station_label"),value:f||i||"",InputProps:{readOnly:!0},helperText:i?a.I18n.t("hafasConfig_station_helper_id").replace("%s",i):a.I18n.t("hafasConfig_station_helper_empty"),disabled:s}),e.jsx(t.Button,{variant:"contained",onClick:m,disabled:s,sx:{mt:.5,minWidth:120},children:a.I18n.t("hafasConfig_station_search_button")})]}),this.state.showStationSearch&&e.jsx(g,{...this.props,onStationSelected:x,onClose:u})]})}}const G={HafasConfig:A,StationSearch:g};export{G as default};
