import{j as e}from"./DefaultPropsProvider-CLe-DXgN.js";import{A as I,a as v}from"./AdminComponentEasyAccessSet__mf_v__runtimeInit__mf_v__-9o5tLcPN.js";import{A as t}from"./AdminComponentEasyAccessSet__loadShare___mf_0_mui_mf_1_material__loadShare__-EKOPJIKX.js";import{A as o}from"./AdminComponentEasyAccessSet__loadShare___mf_0_iobroker_mf_1_adapter_mf_2_react_mf_2_v5__loadShare__-CmYJ37BE.js";import{D as _,T as u,a as p,S,b as y,c as b}from"./Tram-DfEnfuV-.js";import{A as g}from"./AdminComponentEasyAccessSet__loadShare___mf_0_mui_mf_1_icons_mf_2_material__loadShare__-CljkirG-.js";import"./createTheme-7CZNbMr1.js";import"./AdminComponentEasyAccessSet__loadShare__react__loadShare__-CJmceRyn.js";import"./_commonjsHelpers-CE1G-McA.js";import"./createSvgIcon-BA2rfUM-.js";import"./defaultTheme-BJjGWN-J.js";const{loadShare:T}=v,{initPromise:D}=I,A=D.then(r=>T("@iobroker/json-config",{customShareInfo:{shareConfig:{singleton:!0,strictVersion:!1,requiredVersion:"*"}}})),w=await A.then(r=>r());var x=w;const j={suburban:!0,subway:!0,tram:!0,bus:!0,ferry:!0,express:!0,regional:!0},B=[{key:"express",label:"ice_ic_ec",icon:_,color:"#EC0016"},{key:"regional",label:"re_rb",icon:u,color:"#1455C0"},{key:"suburban",label:"s_bahn",icon:p,color:"#008D4F"},{key:"subway",label:"u_bahn",icon:S,color:"#0065AE"},{key:"tram",label:"tram",icon:p,color:"#D5001C"},{key:"bus",label:"bus",icon:y,color:"#A5027D"},{key:"ferry",label:"ferry",icon:b,color:"#0080C8"}],k=({products:r,onChange:a,disabled:s=!1})=>{const l=(i,n)=>{a({...r,[i]:n})};return e.jsxs(t.Paper,{variant:"outlined",sx:{p:2},children:[e.jsx(t.Typography,{variant:"subtitle2",sx:{mb:1},children:o.I18n.t("transport_types")}),e.jsx(t.Box,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:B.map(({key:i,label:n,icon:h,color:d})=>e.jsx(t.FormControlLabel,{disabled:s,control:e.jsx(t.Checkbox,{checked:r[i]??!0,onChange:c=>l(i,c.target.checked),sx:{color:d,"&.Mui-checked":{color:d}},size:"small"}),label:e.jsxs(t.Box,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(h,{sx:{color:s?"grey.500":d,fontSize:20}}),e.jsx(t.Typography,{variant:"body2",color:s?"text.disabled":"text.primary",children:o.I18n.t(n)})]})},i))})]})},P=({station:r,onUpdate:a})=>{const s=h=>{r&&a&&a(r.id,{customName:h.target.value})},l=h=>{r&&a&&a(r.id,{enabled:h.target.checked})},i=h=>{if(r&&a){const d=parseInt(h.target.value,10);!isNaN(d)&&d>0&&a(r.id,{numDepartures:d})}},n=h=>{r&&a&&a(r.id,{products:h})};return e.jsxs(t.Paper,{sx:{p:2,height:"100%"},children:[e.jsx(t.Typography,{variant:"h6",sx:{mb:2},children:o.I18n.t("station_configuration")}),r?e.jsxs(t.Box,{children:[e.jsxs(t.Typography,{variant:"body2",color:"text.secondary",sx:{mb:3},children:[o.I18n.t("configuration_for_station"),": ",r.name]}),e.jsxs(t.Box,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(t.TextField,{label:o.I18n.t("station_id"),value:r.id,disabled:!0,fullWidth:!0,size:"small"}),e.jsx(t.TextField,{label:o.I18n.t("station_name"),value:r.name,disabled:!0,fullWidth:!0,size:"small"}),e.jsx(t.TextField,{label:o.I18n.t("custom_name"),value:r.customName||r.name,onChange:s,fullWidth:!0,size:"small",helperText:o.I18n.t("custom_name_hint")}),e.jsx(t.FormControlLabel,{control:e.jsx(t.Switch,{checked:r.enabled!==!1,onChange:l}),label:o.I18n.t("enabled")}),e.jsx(t.TextField,{label:o.I18n.t("departure_count"),type:"number",value:r.numDepartures||3,onChange:i,fullWidth:!0,size:"small",inputProps:{min:1,max:50},helperText:o.I18n.t("departure_count_hint")}),e.jsx(t.Divider,{sx:{my:1}}),e.jsx(k,{products:r.products||j,onChange:n,disabled:r.enabled===!1})]})]}):e.jsx(t.Box,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"80%",color:"text.secondary"},children:e.jsx(t.Typography,{variant:"body2",children:o.I18n.t("select_station_to_configure")})})]})},F=({stations:r,selectedStationId:a,onAddStation:s,onDeleteStation:l,onStationClick:i})=>e.jsxs(t.Paper,{sx:{p:2,height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(t.Box,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(t.Typography,{variant:"h6",children:o.I18n.t("stations_overview")}),e.jsx(t.Button,{variant:"contained",startIcon:e.jsx(g.Add,{}),onClick:s,size:"small",children:o.I18n.t("add_station")})]}),e.jsx(t.Box,{sx:{flexGrow:1,overflow:"auto"},children:r.length===0?e.jsx(t.Box,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",color:"text.secondary"},children:e.jsx(t.Typography,{variant:"body2",children:o.I18n.t("no_stations_hint")})}):e.jsx(t.List,{children:r.map(n=>e.jsxs(t.ListItemButton,{selected:a===n.id,sx:{border:"1px solid",borderColor:"divider",borderRadius:1,mb:1,opacity:n.enabled===!1?.5:1,"&.Mui-selected":{backgroundColor:"action.selected"}},onClick:()=>i(n.id),children:[e.jsx(t.ListItemText,{primary:n.customName||n.name,secondary:e.jsxs(e.Fragment,{children:[e.jsxs(t.Typography,{component:"span",variant:"caption",display:"block",children:["ID: ",n.id]}),n.customName&&n.customName!==n.name&&e.jsxs(t.Typography,{component:"span",variant:"caption",display:"block",color:"text.secondary",children:["Original: ",n.name]}),e.jsx(t.Typography,{component:"span",variant:"caption",display:"block",children:n.enabled===!1?o.I18n.t("disabled"):o.I18n.t("active")})]}),primaryTypographyProps:{fontWeight:500},secondaryTypographyProps:{component:"div"}}),e.jsx(t.IconButton,{edge:"end","aria-label":"delete",onClick:h=>{h.stopPropagation(),l(n.id)},size:"small",children:e.jsx(g.Delete,{})})]},n.id))})})]});class C extends x.ConfigGeneric{searchTimeout=null;constructor(a){super(a),this.state={...this.state,searchQuery:"",stations:[],selectedStation:null,loading:!1,error:null}}handleClose=()=>{this.props.onClose&&this.props.onClose(),this.setState({searchQuery:"",stations:[],selectedStation:null,error:null})};handleSearchChange=a=>{const s=a.target.value;this.setState({searchQuery:s}),this.searchTimeout&&clearTimeout(this.searchTimeout),s.length>=2?this.searchTimeout=setTimeout(()=>{this.searchStations(s)},500):this.setState({stations:[],selectedStation:null})};searchStations=async a=>{this.setState({loading:!0,error:null});try{const s=await this.props.oContext.socket.sendTo(`${this.props.oContext.adapterName}.${this.props.oContext.instance}`,"location",{query:a});console.log("Search result:",s),console.log("Result type:",typeof s,"Is array:",Array.isArray(s)),s&&Array.isArray(s)?(console.log("Number of stations:",s.length),s.length>0&&console.log("First station:",JSON.stringify(s[0],null,2)),this.setState({stations:s,loading:!1})):this.setState({stations:[],loading:!1,error:o.I18n.t("stationSearch_no_results_found")})}catch(s){console.error("Search error:",s),this.setState({loading:!1,error:o.I18n.t("stationSearch_error").replace("%s",s instanceof Error?s.message:String(s))})}};handleStationSelect=a=>{this.setState({selectedStation:a})};handleConfirm=()=>{this.state.selectedStation&&(console.log("Confirming station:",this.state.selectedStation),this.props.onStationSelected&&this.props.onStationSelected(this.state.selectedStation.id,this.state.selectedStation.name),this.handleClose())};getProductIcons=a=>{if(!a)return console.log("No products provided"),[];console.log("Products:",a);const s=[],l={tram:{icon:e.jsx(p,{fontSize:"small"}),label:"tram",color:"#D5001C"},bus:{icon:e.jsx(y,{fontSize:"small"}),label:"bus",color:"#a5027D"},subway:{icon:e.jsx(S,{fontSize:"small"}),label:"u_bahn",color:"#0065AE"},express:{icon:e.jsx(_,{fontSize:"small"}),label:"ice_ic_ec",color:"#ec0016"},regional:{icon:e.jsx(u,{fontSize:"small"}),label:"re_rb",color:"#1455C0"},ferry:{icon:e.jsx(b,{fontSize:"small"}),label:"ferry",color:"#0080C8"},suburban:{icon:e.jsx(u,{fontSize:"small"}),label:"s_bahn",color:"#008D4F"}};return Object.entries(a).forEach(([i,n])=>{console.log(`Product ${i}: ${n}`),n&&l[i]&&s.push(e.jsx(t.Tooltip,{title:o.I18n.t(l[i].label),arrow:!0,children:e.jsx(t.Box,{component:"span",title:l[i].label,sx:{display:"inline-flex",alignItems:"center",color:l[i].color,mr:1},children:l[i].icon},i)},i))}),console.log("Generated icons count:",s.length),s};renderItem(a,s){const{searchQuery:l,stations:i,selectedStation:n,loading:h,error:d}=this.state;return e.jsxs(t.Dialog,{open:!0,onClose:this.handleClose,maxWidth:"sm",fullWidth:!0,children:[e.jsx(t.DialogTitle,{children:o.I18n.t("stationSearch_title")}),e.jsxs(t.DialogContent,{children:[e.jsx(t.TextField,{autoFocus:!0,fullWidth:!0,label:o.I18n.t("stationSearch_input_label"),value:l,onChange:this.handleSearchChange,placeholder:o.I18n.t("stationSearch_input_placeholder"),sx:{mt:2,mb:2}}),h&&e.jsx(t.Box,{sx:{display:"flex",justifyContent:"center",p:2},children:e.jsx(t.CircularProgress,{})}),d&&e.jsx(t.Typography,{color:"error",sx:{p:2,textAlign:"center"},children:d}),!h&&!d&&i.length>0&&e.jsx(t.List,{sx:{maxHeight:400,overflow:"auto"},children:i.map(c=>{var m,f;return e.jsx(t.ListItem,{disablePadding:!0,children:e.jsx(t.ListItemButton,{selected:(n==null?void 0:n.id)===c.id,onClick:()=>this.handleStationSelect(c),children:e.jsx(t.ListItemText,{primary:c.name,secondary:e.jsxs(t.Box,{sx:{mt:.5},children:[e.jsx(t.Typography,{variant:"caption",display:"block",sx:{mb:.5},children:c.type?`${c.type}${c.location?` (${(m=c.location.latitude)==null?void 0:m.toFixed(4)}, ${(f=c.location.longitude)==null?void 0:f.toFixed(4)})`:""}`:c.id}),c.products&&e.jsx(t.Box,{sx:{display:"flex",flexWrap:"wrap"},children:this.getProductIcons(c.products)})]})})})},c.id)})}),!h&&!d&&l.length>=2&&i.length===0&&e.jsx(t.Typography,{color:"text.secondary",sx:{p:2,textAlign:"center"},children:o.I18n.t("stationSearch_no_results")}),l.length<2&&e.jsx(t.Typography,{color:"text.secondary",sx:{p:2,textAlign:"center"},children:o.I18n.t("stationSearch_min_chars")})]}),e.jsxs(t.DialogActions,{children:[e.jsx(t.Button,{onClick:this.handleClose,children:o.I18n.t("stationSearch_cancel")}),e.jsx(t.Button,{onClick:this.handleConfirm,variant:"contained",disabled:!n,children:o.I18n.t("stationSearch_confirm")})]})]})}}class N extends x.ConfigGeneric{constructor(a){super(a);const s=x.ConfigGeneric.getValue(this.props.data,"departures"),l=Array.isArray(s)?s:[];this.state={...this.state,stations:l,selectedStationId:null,showSearchDialog:!1}}componentDidMount(){const a=x.ConfigGeneric.getValue(this.props.data,"departures");Array.isArray(a)&&this.setState({stations:a})}componentDidUpdate(a){if(a.data!==this.props.data){const s=x.ConfigGeneric.getValue(this.props.data,"departures");Array.isArray(s)&&this.setState({stations:s})}}handleAddStation=()=>{this.setState({showSearchDialog:!0})};handleStationSelected=async(a,s)=>{const l={id:a,name:s,customName:s,enabled:!0,numDepartures:10,products:{...j}};if(!this.state.stations.some(n=>n.id===a)){const n=[...this.state.stations,l];this.setState({stations:n,selectedStationId:a}),await this.onChange("departures",n)}this.setState({showSearchDialog:!1})};handleDeleteStation=async a=>{const s=this.state.stations.filter(l=>l.id!==a);this.setState({stations:s}),await this.onChange("departures",s),this.state.selectedStationId===a&&this.setState({selectedStationId:null})};handleStationUpdate=async(a,s)=>{const l=this.state.stations.map(i=>i.id===a?{...i,...s}:i);this.setState({stations:l}),await this.onChange("departures",l)};handleStationClick=a=>{this.setState({selectedStationId:a})};handleCloseSearch=()=>{this.setState({showSearchDialog:!1})};render(){const{stations:a,selectedStationId:s,showSearchDialog:l}=this.state,i=a.find(n=>n.id===s)||null;return e.jsxs(t.Box,{sx:{height:"100%",p:{xs:1,sm:2}},children:[e.jsxs(t.Grid,{container:!0,spacing:{xs:1,sm:2},sx:{height:"100%",flexDirection:{xs:"column",md:"row"}},children:[e.jsx(t.Grid,{item:!0,xs:12,md:5,sx:{height:{xs:"auto",md:"100%"},minHeight:{xs:300,md:"auto"},maxHeight:{xs:400,md:"none"}},children:e.jsx(F,{stations:a,selectedStationId:s,onAddStation:this.handleAddStation,onDeleteStation:this.handleDeleteStation,onStationClick:this.handleStationClick})}),e.jsx(t.Grid,{item:!0,xs:12,md:7,sx:{height:{xs:"auto",md:"100%"},minHeight:{xs:200,md:"auto"}},children:e.jsx(P,{station:i,onUpdate:this.handleStationUpdate})})]}),e.jsx(t.Dialog,{open:l,onClose:this.handleCloseSearch,maxWidth:"md",fullWidth:!0,fullScreen:!1,sx:{"& .MuiDialog-paper":{m:{xs:1,sm:2},maxHeight:{xs:"calc(100% - 16px)",sm:"calc(100% - 64px)"},width:{xs:"calc(100% - 16px)",sm:"auto"}}},children:e.jsx(C,{...this.props,onStationSelected:this.handleStationSelected,onClose:this.handleCloseSearch})})]})}}class W extends x.ConfigGeneric{constructor(a){super(a),this.state={...this.state}}renderItem(a,s){const l=x.ConfigGeneric.getValue(this.props.data,"hafasProfile"),i=x.ConfigGeneric.getValue(this.props.data,"clientName"),n=async d=>{const c=d.target.value;await this.onChange("hafasProfile",c)},h=async d=>{const c=d.target.value;await this.onChange("clientName",c)};return e.jsxs(t.Box,{sx:{p:{xs:1,sm:2},maxWidth:1200,mx:"auto"},children:[e.jsx(t.Typography,{variant:"h5",sx:{mb:{xs:2,sm:3},fontSize:{xs:"1.25rem",sm:"1.5rem"}},children:o.I18n.t("hafasConfig_title")}),e.jsxs(t.Box,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2,mb:3},children:[e.jsxs(t.FormControl,{sx:{flex:{sm:"1 1 0"},minWidth:{xs:"100%",sm:200}},disabled:s,fullWidth:!0,children:[e.jsx(t.InputLabel,{id:"hafas-profile-label",children:o.I18n.t("hafasConfig_profile_label")}),e.jsxs(t.Select,{labelId:"hafas-profile-label",id:"hafas-profile-select",value:l||"",label:o.I18n.t("hafasConfig_profile_label"),onChange:n,children:[e.jsx(t.MenuItem,{value:"vbb",children:o.I18n.t("hafasConfig_profile_vbb")}),e.jsx(t.MenuItem,{value:"db",children:o.I18n.t("hafasConfig_profile_db")})]}),e.jsx(t.FormHelperText,{children:o.I18n.t("hafasConfig_profile_helper")})]}),e.jsx(t.FormControl,{sx:{flex:{sm:"1 1 0"},minWidth:{xs:"100%",sm:200}},disabled:s,fullWidth:!0,children:e.jsx(t.TextField,{id:"client-name-input",label:o.I18n.t("hafasConfig_clientName_label"),value:i||"",onChange:h,helperText:o.I18n.t("hafasConfig_clientName_helper"),disabled:s,fullWidth:!0})})]})]})}}const q={DepartureManager:N,HafasConfig:W,StationSearch:C};export{q as default};
