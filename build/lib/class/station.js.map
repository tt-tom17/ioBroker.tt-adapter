{
  "version": 3,
  "sources": ["../../../src/lib/class/station.ts"],
  "sourcesContent": ["import type * as Hafas from 'hafas-client';\nimport type { TTAdapter } from '../../main';\nimport { genericStateObjects } from '../const/definition';\nimport { BaseClass } from '../tools/library';\nimport { mapStationToStationState } from '../tools/mapper';\nimport type { StationState } from '../types/types';\n\nexport class StationRequest extends BaseClass {\n    constructor(adapter: TTAdapter) {\n        super(adapter);\n        this.log.setLogPrefix('stationReq');\n    }\n\n    public async getStation(\n        stationId: string,\n        service: any,\n        options?: Hafas.StopOptions,\n    ): Promise<Hafas.Station | Hafas.Stop> {\n        try {\n            if (!stationId) {\n                throw new Error(this.library.translate('msg_departureNoStationId'));\n            }\n            if (!service) {\n                throw new Error(this.library.translate('msg_noServices'));\n            }\n            const station: Hafas.Station | Hafas.Stop = await service.getStop(stationId, options);\n            // Vollst\u00E4ndiges JSON f\u00FCr Debugging\n            this.adapter.log.debug(JSON.stringify(station, null, 1));\n            return station;\n        } catch (err) {\n            this.log.error(this.library.translate('msg_stationQueryError', stationId, (err as Error).message));\n            throw err;\n        }\n    }\n    async writeStationData(stationData: Hafas.Station | Hafas.Stop): Promise<void> {\n        try {\n            await this.library.writedp(\n                `${this.adapter.namespace}.Stations.${stationData.id}.info.json`,\n                JSON.stringify(stationData),\n                {\n                    _id: 'nicht_definieren',\n                    type: 'state',\n                    common: {\n                        name: 'raw station data',\n                        type: 'string',\n                        role: 'json',\n                        read: true,\n                        write: false,\n                    },\n                    native: {},\n                },\n            );\n            const stationState: StationState = mapStationToStationState(stationData);\n            // Vor dem Schreiben alte States l\u00F6schen\n            await this.library.garbageColleting(`${this.adapter.namespace}.Stations.${stationData.id}.info.`, 2000);\n            // JSON in die States schreiben\n            await this.library.writeFromJson(\n                `${this.adapter.namespace}.Stations.${stationData.id}.info`,\n                'station',\n                genericStateObjects,\n                stationState,\n                true,\n            );\n        } catch (err) {\n            this.log.error(this.library.translate('msg_stationWriteError', (err as Error).message));\n        }\n    }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA,wBAAoC;AACpC,qBAA0B;AAC1B,oBAAyC;AAGlC,MAAM,uBAAuB,yBAAU;AAAA,EAC1C,YAAY,SAAoB;AAC5B,UAAM,OAAO;AACb,SAAK,IAAI,aAAa,YAAY;AAAA,EACtC;AAAA,EAEA,MAAa,WACT,WACA,SACA,SACmC;AACnC,QAAI;AACA,UAAI,CAAC,WAAW;AACZ,cAAM,IAAI,MAAM,KAAK,QAAQ,UAAU,0BAA0B,CAAC;AAAA,MACtE;AACA,UAAI,CAAC,SAAS;AACV,cAAM,IAAI,MAAM,KAAK,QAAQ,UAAU,gBAAgB,CAAC;AAAA,MAC5D;AACA,YAAM,UAAsC,MAAM,QAAQ,QAAQ,WAAW,OAAO;AAEpF,WAAK,QAAQ,IAAI,MAAM,KAAK,UAAU,SAAS,MAAM,CAAC,CAAC;AACvD,aAAO;AAAA,IACX,SAAS,KAAK;AACV,WAAK,IAAI,MAAM,KAAK,QAAQ,UAAU,yBAAyB,WAAY,IAAc,OAAO,CAAC;AACjG,YAAM;AAAA,IACV;AAAA,EACJ;AAAA,EACA,MAAM,iBAAiB,aAAwD;AAC3E,QAAI;AACA,YAAM,KAAK,QAAQ;AAAA,QACf,GAAG,KAAK,QAAQ,SAAS,aAAa,YAAY,EAAE;AAAA,QACpD,KAAK,UAAU,WAAW;AAAA,QAC1B;AAAA,UACI,KAAK;AAAA,UACL,MAAM;AAAA,UACN,QAAQ;AAAA,YACJ,MAAM;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,OAAO;AAAA,UACX;AAAA,UACA,QAAQ,CAAC;AAAA,QACb;AAAA,MACJ;AACA,YAAM,mBAA6B,wCAAyB,WAAW;AAEvE,YAAM,KAAK,QAAQ,iBAAiB,GAAG,KAAK,QAAQ,SAAS,aAAa,YAAY,EAAE,UAAU,GAAI;AAEtG,YAAM,KAAK,QAAQ;AAAA,QACf,GAAG,KAAK,QAAQ,SAAS,aAAa,YAAY,EAAE;AAAA,QACpD;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MACJ;AAAA,IACJ,SAAS,KAAK;AACV,WAAK,IAAI,MAAM,KAAK,QAAQ,UAAU,yBAA0B,IAAc,OAAO,CAAC;AAAA,IAC1F;AAAA,EACJ;AACJ;",
  "names": []
}
